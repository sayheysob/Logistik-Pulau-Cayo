<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Check Log - Logistik Pulau Cayo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(180deg, #a0e9ff 0%, #ffffff 70%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #1e3a8a;
      overflow-x: hidden;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <!-- Navbar -->
  <nav class="w-full bg-white/80 backdrop-blur-md shadow-md sticky top-0 z-50">
    <div class="container mx-auto flex flex-wrap items-center justify-between py-5 px-6 md:px-0">
      <div class="flex items-center space-x-3">
        <img alt="Logo Logistik Pulau Cayo" class="w-12 h-12 rounded-full shadow-md" src="images/lpc.png" />
        <span class="text-3xl font-extrabold text-teal-700 select-none tracking-wide drop-shadow-md">
          Logistik Pulau Cayo
        </span>
      </div>
      <div class="text-sm font-semibold text-teal-900 bg-teal-100/70 px-4 py-2 rounded-xl shadow-inner select-none max-w-xs overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-teal-400 scrollbar-track-teal-200" id="dateTime"></div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto flex-grow px-6 py-20 md:py-24 relative z-10">
    <header class="mb-12 text-center max-w-3xl mx-auto">
      <h1 class="text-5xl font-extrabold text-teal-900 mb-4 tracking-tight drop-shadow-lg">Check Log</h1>
      <p class="text-xl md:text-2xl text-teal-700 font-semibold tracking-wide max-w-xl mx-auto leading-relaxed drop-shadow-sm">
        Monitoring aktivitas dan kehadiran anggota logistik Pulau Cayo.
      </p>
    </header>

    <section class="max-w-2xl mx-auto space-y-10">
      <!-- Pilih Anggota -->
      <div class="bg-white/90 p-8 rounded-3xl shadow-xl border border-teal-300">
        <label for="search" class="block text-lg font-semibold text-teal-800 mb-2">Pilih Anggota</label>
        <select id="search" required class="w-full p-3 rounded-lg border border-teal-300 focus:outline-none focus:ring-2 focus:ring-teal-400 text-teal-900">
          <option value="">Pilih nama anggota...</option>
        </select>
      </div>

      <!-- Profil -->
      <div id="profileCard" hidden class="bg-white/90 p-8 rounded-3xl shadow-xl border border-teal-300">
        <h3 id="nama" class="text-2xl font-bold text-teal-900 mb-2">Nama Anggota</h3>
        <p id="status" class="text-teal-700"></p>
      </div>

      <!-- Statistik -->
      <div id="stats" hidden class="bg-white/90 p-8 rounded-3xl shadow-xl border border-teal-300">
        <h4 class="text-xl font-bold text-teal-800 mb-4">Statistik Kehadiran</h4>
        <p class="text-teal-700"><strong>Total Jam:</strong> <span id="totalJam">-</span></p>
        <p class="text-teal-700"><strong>Rata-Rata Harian:</strong> <span id="rataJam">-</span></p>
      </div>

      <!-- Aktivitas Terakhir -->
      <div id="aktivitasSection" hidden class="bg-white/90 p-8 rounded-3xl shadow-xl border border-teal-300">
        <h4 class="text-xl font-bold text-teal-800 mb-4">Aktivitas Terakhir</h4>
        <div id="aktivitasLog" class="text-teal-700 space-y-2"></div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="w-full bg-white/80 backdrop-blur-md border-t border-teal-300 shadow-inner relative z-10">
    <div class="container mx-auto py-6 px-6 text-center text-teal-900 text-sm select-none font-semibold tracking-wide drop-shadow-sm">
      © 2025 Logistik Pulau Cayo • Sistem Monitoring Anggota
    </div>
  </footer>

  <!-- Script -->
  <script>
    function updateDateTime() {
      const el = document.getElementById('dateTime');
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const time = now.toLocaleTimeString('id-ID');
      const date = now.toLocaleDateString('id-ID', options);
      el.textContent = `${date} • ${time}`;
    }
    updateDateTime();
    setInterval(updateDateTime, 1000);

    let currentMember = null;
    let fullData = [];

    const profileCard = document.getElementById('profileCard');
    const stats = document.getElementById('stats');
    const aktivitasSection = document.getElementById('aktivitasSection');

    function updateProfile(anggota) {
      document.getElementById("nama").textContent = anggota.nama;
      document.getElementById("status").innerHTML = `<em>${anggota.jabatan}</em>`;
    }

    function handleMemberSelection() {
      const selectedName = this.value;
      if (!selectedName) return;
      currentMember = fullData.find(a => a.nama === selectedName);
      if (!currentMember) return;

      updateProfile(currentMember);
      updateStats(currentMember);
      updateActivityLog(currentMember);

      profileCard.hidden = false;
      stats.hidden = false;
      aktivitasSection.hidden = false;
    }

    function updateStats(anggota) {
      document.getElementById("totalJam").textContent = anggota.totalJam;
      document.getElementById("rataJam").textContent = anggota.rataRataJam;
    }

    function updateActivityLog(anggota) {
      const log = document.getElementById("aktivitasLog");
      log.innerHTML = "";

      if (anggota.aktivitas && anggota.aktivitas.length > 0) {
        anggota.aktivitas.forEach(act => {
          const p = document.createElement("p");
          p.innerHTML = `<strong>${act.waktu}</strong>: ${act.deskripsi}`;
          log.appendChild(p);
        });
      } else {
        const p = document.createElement("p");
        p.innerHTML = "<em>Tidak ada aktivitas tercatat.</em>";
        log.appendChild(p);
      }
    }

    function populateDropdown(data) {
      const select = document.getElementById("search");
      select.innerHTML = '<option value="">Pilih nama anggota...</option>';
      data.forEach(anggota => {
        const opt = document.createElement("option");
        opt.value = anggota.nama;
        opt.textContent = anggota.nama;
        select.appendChild(opt);
      });
    }

    async function loadSheetData() {
      try {
        const response = await fetch('https://opensheet.elk.sh/149mLW4EvpeoNbIXS_FwEgo489yjQa1l7kFuwvcUBxCg/Anggota');
        const data = await response.json();

        fullData = data.map(member => ({
          nama: member.NAMA,
          jabatan: member.JABATAN || 'Tidak Ada Data',
          totalJam: member.TOTAL_JAM || '-',
          rataRataJam: member.RATA_RATA || '-',
          aktivitas: [] // Tambahkan aktivitas jika tersedia
        }));

        populateDropdown(fullData);
      } catch (e) {
        console.error('Gagal memuat data:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', loadSheetData);
    document.getElementById("search").addEventListener("change", handleMemberSelection);
  </script>
</body>
</html>